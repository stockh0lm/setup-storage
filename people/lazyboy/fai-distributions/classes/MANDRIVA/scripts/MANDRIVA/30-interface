#! /bin/sh

error=0 ; trap "error=$((error|1))" ERR

if ifclass DHCPC
then
    cat > $target/etc/sysconfig/network-scripts/ifcfg-eth0 <<-EOF
# generated by FAI
DEVICE=eth0
BOOTPROTO=dhcp
ONBOOT=yes
USERCTL=no
EOF
else
    cat > $target/etc/sysconfig/network-scripts/ifcfg-eth0 <<-EOF
# generated by FAI
DEVICE=eth0
BOOTPROTO=none
ONBOOT=yes
IPADDR=$IPADDR
NETMASK=$NETMASK
GATEWAY=$GATEWAYS
USERCTL=no
TYPE=Ethernet
PEERDNS=no
EOF
    [ -s /tmp/etc/resolv.conf ] && cp -p /tmp/etc/resolv.conf $target/etc
    fcopy -C /tmp/fai/FAI_CLASSES -i /etc/resolv.conf
fi

cat > $target/etc/sysconfig/network <<-EOF
HOSTNAME=$HOSTNAME
NETWORKING=yes
GATEWAY=$GATEWAYS
EOF

# Is this mandatory for Mandriva ?
cp $target/etc/sysconfig/network-scripts/ifcfg-* $target/etc/sysconfig/networking/devices
cp $target/etc/sysconfig/network-scripts/ifcfg-* $target/etc/sysconfig/networking/profiles/default

# here fcopy is mostly used, when installing a client for running in a
# different subnet than during the installation  
# fcopy -iM /etc/network/interfaces /etc/networks

exit $error
