#! /bin/bash

error=0 ; trap "error=$((error|1))" ERR

if  [ ifclass DHCPC && ifclass DIST-DEBIAN ]
then
    cat > $target/etc/network/interfaces <<-EOF
	# generated by FAI
	auto lo eth0
	iface lo inet loopback
	iface eth0 inet dhcp
EOF
elif ifclass DIST-DEBIAN; then
      [ -n "$IPADDR" ] && cat > $target/etc/network/interfaces <<-EOF
	# generated by FAI
	auto lo eth0
	iface lo inet loopback
	iface eth0 inet static
	  address $IPADDR
	  netmask $NETMASK
	  broadcast $BROADCAST
	  gateway $GATEWAYS
EOF
fi

ifclass DHCPC &&  {
    [ -n "$NETWORK" ] && echo "localnet $NETWORK" > $target/etc/networks
    [ -s /tmp/etc/resolv.conf ] && cp -p /tmp/etc/resolv.conf $target/etc
    fcopy -i /etc/resolv.conf
}

# here fcopy is mostly used, when installing a client for running in a
# different subnet than during the installation  
if ifclass DIST-DEBIAN; then
	fcopy -iM /etc/network/interfaces /etc/networks
fi

exit $error
