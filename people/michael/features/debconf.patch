Index: debian/control
===================================================================
--- debian/control	(.../tags/2.8.4sarge1)	(revision 5044)
+++ debian/control	(.../people/michael/features/debconf)	(revision 5044)
@@ -7,7 +7,7 @@
 
 Package: fai
 Architecture: all
-Depends: perl, libapt-pkg-perl
+Depends: perl, libapt-pkg-perl, debconf
 Recommends: debootstrap, nfs-kernel-server | nfs-server, fai-kernels, dhcp3-server | bootp, tftpd-hpa | tftpd, rsh-server, wget, syslinux
 Suggests: ssh, debmirror, mknbi, apt-move, mkinitrd-cd, grub
 Description:  Fully Automatic Installation
Index: debian/default.tpl
===================================================================
--- debian/default.tpl	(.../tags/2.8.4sarge1)	(revision 0)
+++ debian/default.tpl	(.../people/michael/features/debconf)	(revision 5044)
@@ -0,0 +1,7 @@
+# installserver must be the name seen by the install clients
+# set this to the IP address or hostname of the server providing the
+# nfsroot
+installserver=
+# the name of the Debian mirror (e.g., ftp.debian.org)
+mirrorhost=
+
Index: debian/postinst
===================================================================
--- debian/postinst	(.../tags/2.8.4sarge1)	(revision 5044)
+++ debian/postinst	(.../people/michael/features/debconf)	(revision 5044)
@@ -34,6 +34,17 @@
 case "$1" in
     configure)
 
+        . /usr/share/debconf/confmodule
+        # set installserver hostname to a reasonable value with debconf
+        db_get fai/installserver
+        perl -pi -e "s/^installserver=.*\$/installserver=$RET/" /etc/default/fai
+
+        # set mirrorhost in  /etc/fai.conf and  /etc/fai/sources.list as
+        # defined in debconf db
+        db_get fai/mirrorhost
+        perl -pi -e "s/^mirrorhost=.*\$/mirrorhost=$RET/" /etc/default/fai
+        #db_get fai/run-faisetup-on-install || true
+
         echo "Now edit fai.conf, make-fai-nfsroot.conf and sources.list in /etc/fai and call fai-setup."
 	echo "Especially, you'll have to replace the placeholder INSTALLSERVER in /etc/fai/fai.conf."
         ;;
Index: debian/rules
===================================================================
--- debian/rules	(.../tags/2.8.4sarge1)	(revision 5044)
+++ debian/rules	(.../people/michael/features/debconf)	(revision 5044)
@@ -41,7 +38,7 @@
 binary-indep: build install
 	dh_testdir
 	dh_testroot
-#	dh_installdebconf	
+	dh_installdebconf	
 	dh_installdocs
 #	dh_installexamples
 #	dh_installmenu
Index: debian/templates
===================================================================
--- debian/templates	(.../tags/2.8.4sarge1)	(revision 0)
+++ debian/templates	(.../people/michael/features/debconf)	(revision 5044)
@@ -0,0 +1,35 @@
+Template: fai/installserver
+Type: string
+_Description: Set install server hostname.
+ FAI needs a name for the install server to be used.
+ .
+ In most cases this will be the hostname of the machine where the FAI
+ package is installed, so we use this as a default value.
+ .
+ In case you want your install clients to use another install server,
+ please provide it's hostname.
+
+Template: fai/mirrorhost
+Type: string
+_Description: Set the hostname of the debian mirror to be used.
+ FAI needs the hostname of the debian mirror used for creating
+ the nfsroot and to get packages for the actual installation.
+ .
+ In case you are running your own debian mirror, and want to use this 
+ for FAI, please enter it's hostname here. In case you don't have
+ an own debian mirror, you will most probably use ftp.debian.org
+ for that, which we provide as a default.
+
+Template: fai/run-faisetup-on-install
+Type: boolean
+Default: false
+_Description: Run fai-setup script now?
+ To be able to do installations with FAI, the script fai-setup
+ needs to be run. In case you don't need to tweak the default
+ FAI config any further, this can be done for you now.
+ .
+ If you intend to have a look at and tweak the config files, it's
+ perfectly okay to run the script fai-setup manually after
+ you consider the configuration fitting for you.
+ .
+ Do you want the fai-setup script to be run now?
Index: debian/dirs
===================================================================
--- debian/dirs	(.../tags/2.8.4sarge1)	(revision 5044)
+++ debian/dirs	(.../people/michael/features/debconf)	(revision 5044)
@@ -10,3 +10,4 @@
 usr/lib/fai/nfsroot
 usr/share/perl5/Debian
 boot/fai
+etc/default
Index: debian/config
===================================================================
--- debian/config	(.../tags/2.8.4sarge1)	(revision 0)
+++ debian/config	(.../people/michael/features/debconf)	(revision 5044)
@@ -0,0 +1,32 @@
+#! /bin/bash
+
+set -e
+. /usr/share/debconf/confmodule
+
+[ -r /etc/default/fai ] && . /etc/default/fai
+
+# check if installserver value is already set, otherwise set default 
+if [ -z $installserver ] ; then
+  db_get fai/installserver
+  if [ "$RET" = "" ]; then
+    db_set fai/installserver $(hostname)
+  fi
+else
+  db_set fai/installserver $installserver
+fi
+
+db_input medium fai/installserver || true
+db_go || true
+
+if [ -z $mirrorhost ] ; then
+  db_get fai/mirrorhost
+  if [ "$RET" = "" ]; then
+    db_set fai/mirrorhost ftp.debian.org
+  fi
+else
+  db_set fai/mirrorhost $mirrorhost
+fi
+
+db_input medium fai/mirrorhost || true
+
+db_go || true
Index: debian/po/templates.pot
===================================================================
--- debian/po/templates.pot	(.../tags/2.8.4sarge1)	(revision 0)
+++ debian/po/templates.pot	(.../people/michael/features/debconf)	(revision 5044)
@@ -0,0 +1,107 @@
+#
+#    Translators, if you are not familiar with the PO format, gettext
+#    documentation is worth reading, especially sections dedicated to
+#    this format, e.g. by running:
+#         info -n '(gettext)PO Files'
+#         info -n '(gettext)Header Entry'
+#
+#    Some information specific to po-debconf are available at
+#            /usr/share/doc/po-debconf/README-trans
+#         or http://www.debian.org/intl/l10n/po-debconf/README-trans
+#
+#    Developers do not need to manually edit POT or PO files.
+#
+#, fuzzy
+msgid ""
+msgstr ""
+"Project-Id-Version: PACKAGE VERSION\n"
+"Report-Msgid-Bugs-To: \n"
+"POT-Creation-Date: 2005-04-08 16:29+0200\n"
+"PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
+"Last-Translator: FULL NAME <EMAIL@ADDRESS>\n"
+"Language-Team: LANGUAGE <LL@li.org>\n"
+"MIME-Version: 1.0\n"
+"Content-Type: text/plain; charset=CHARSET\n"
+"Content-Transfer-Encoding: 8bit\n"
+
+#. Type: string
+#. Description
+#: ../templates:3
+msgid "Set install server hostname."
+msgstr ""
+
+#. Type: string
+#. Description
+#: ../templates:3
+msgid "FAI needs a name for the install server to be used."
+msgstr ""
+
+#. Type: string
+#. Description
+#: ../templates:3
+msgid ""
+"In most cases this will be the hostname of the machine where the FAI package "
+"is installed, so we use this as a default value."
+msgstr ""
+
+#. Type: string
+#. Description
+#: ../templates:3
+msgid ""
+"In case you want your install clients to use another install server, please "
+"provide it's hostname."
+msgstr ""
+
+#. Type: string
+#. Description
+#: ../templates:14
+msgid "Set the hostname of the debian mirror to be used."
+msgstr ""
+
+#. Type: string
+#. Description
+#: ../templates:14
+msgid ""
+"FAI needs the hostname of the debian mirror used for creating the nfsroot "
+"and to get packages for the actual installation."
+msgstr ""
+
+#. Type: string
+#. Description
+#: ../templates:14
+msgid ""
+"In case you are running your own debian mirror, and want to use this  for "
+"FAI, please enter it's hostname here. In case you don't have an own debian "
+"mirror, you will most probably use ftp.debian.org for that, which we provide "
+"as a default."
+msgstr ""
+
+#. Type: boolean
+#. Description
+#: ../templates:26
+msgid "Run fai-setup script now?"
+msgstr ""
+
+#. Type: boolean
+#. Description
+#: ../templates:26
+msgid ""
+"To be able to do installations with FAI, the script fai-setup needs to be "
+"run. In case you don't need to tweak the default FAI config any further, "
+"this can be done for you now."
+msgstr ""
+
+#. Type: boolean
+#. Description
+#: ../templates:26
+msgid ""
+"If you intend to have a look at and tweak the config files, it's perfectly "
+"okay to run the script fai-setup manually after you consider the "
+"configuration fitting for you."
+msgstr ""
+
+#. Type: boolean
+#. Description
+#: ../templates:26
+msgid "Do you want the fai-setup script to be run now?"
+msgstr ""
Index: debian/po/fr.po
===================================================================
--- debian/po/fr.po	(.../tags/2.8.4sarge1)	(revision 0)
+++ debian/po/fr.po	(.../people/michael/features/debconf)	(revision 5044)
@@ -0,0 +1,125 @@
+#
+#    Translators, if you are not familiar with the PO format, gettext
+#    documentation is worth reading, especially sections dedicated to
+#    this format, e.g. by running:
+#         info -n '(gettext)PO Files'
+#         info -n '(gettext)Header Entry'
+#
+#    Some information specific to po-debconf are available at
+#            /usr/share/doc/po-debconf/README-trans
+#         or http://www.debian.org/intl/l10n/po-debconf/README-trans
+#
+#    Developers do not need to manually edit POT or PO files.
+#
+msgid ""
+msgstr ""
+"Project-Id-Version: fai_2.8\n"
+"Report-Msgid-Bugs-To: \n"
+"POT-Creation-Date: 2005-04-08 16:29+0200\n"
+"PO-Revision-Date: 2005-04-16 11:16+0100\n"
+"Last-Translator: Steve Petruzzello <dlist@bluewin.ch>\n"
+"Language-Team: French <debian-l10n-french@lists.debian.org>\n"
+"MIME-Version: 1.0\n"
+"Content-Type: text/plain; charset=iso-8859-15\n"
+"Content-Transfer-Encoding: 8bit\n"
+"X-Poedit-Language: French\n"
+"X-Poedit-Country: SWITZERLAND\n"
+"X-Poedit-SourceCharset: iso-8859-1\n"
+
+#. Type: string
+#. Description
+#: ../templates:3
+msgid "Set install server hostname."
+msgstr "Nom d'hôte du serveur d'installation :"
+
+#. Type: string
+#. Description
+#: ../templates:3
+msgid "FAI needs a name for the install server to be used."
+msgstr "Veuillez indiquer le nom d'hôte du serveur d'installation."
+
+#. Type: string
+#. Description
+#: ../templates:3
+msgid ""
+"In most cases this will be the hostname of the machine where the FAI package "
+"is installed, so we use this as a default value."
+msgstr ""
+"Par défaut, ce sera le nom d'hôte de la machine sur laquelle FAI est "
+"installé."
+
+#. Type: string
+#. Description
+#: ../templates:3
+msgid ""
+"In case you want your install clients to use another install server, please "
+"provide it's hostname."
+msgstr ""
+"Dans le cas où vous voulez utiliser un autre serveur d'installation pour vos "
+"clients, veuillez indiquer son nom d'hôte."
+
+#. Type: string
+#. Description
+#: ../templates:14
+msgid "Set the hostname of the debian mirror to be used."
+msgstr "Miroir Debian à utiliser :"
+
+#. Type: string
+#. Description
+#: ../templates:14
+msgid ""
+"FAI needs the hostname of the debian mirror used for creating the nfsroot "
+"and to get packages for the actual installation."
+msgstr ""
+"Veuillez indiquer le nom d'hôte du miroir Debian utilisé pour créer la "
+"racine du système de fichiers NFS et qui sera la source des paquets "
+"installés."
+
+#. Type: string
+#. Description
+#: ../templates:14
+msgid ""
+"In case you are running your own debian mirror, and want to use this  for "
+"FAI, please enter it's hostname here. In case you don't have an own debian "
+"mirror, you will most probably use ftp.debian.org for that, which we provide "
+"as a default."
+msgstr ""
+"Si vous souhaitez utiliser votre propre miroir Debian avec FAI, veuillez "
+"indiquer son nom d'hôte. Dans le cas contraire, vous devriez choisir le "
+"serveur par défaut « ftp.debian.org »."
+
+#. Type: boolean
+#. Description
+#: ../templates:26
+msgid "Run fai-setup script now?"
+msgstr "Faut-il exécuter le script de configuration de FAI maintenant ?"
+
+#. Type: boolean
+#. Description
+#: ../templates:26
+msgid ""
+"To be able to do installations with FAI, the script fai-setup needs to be "
+"run. In case you don't need to tweak the default FAI config any further, "
+"this can be done for you now."
+msgstr ""
+"Afin d'utiliser FAI, le script de configuration doit être exécuté. Si vous "
+"n'avez pas besoin de modifier la configuration par défaut de FAI, cela peut "
+"se faire immédiatement. "
+
+#. Type: boolean
+#. Description
+#: ../templates:26
+msgid ""
+"If you intend to have a look at and tweak the config files, it's perfectly "
+"okay to run the script fai-setup manually after you consider the "
+"configuration fitting for you."
+msgstr ""
+"Si vous voulez modifier les fichiers de configuration, vous pourrez exécuter "
+"vous-même le script de configuration ensuite."
+
+#. Type: boolean
+#. Description
+#: ../templates:26
+msgid "Do you want the fai-setup script to be run now?"
+msgstr ""
+"Veuillez choisir si le script de configuration doit être exécuté maintenant."
Index: debian/po/de.po
===================================================================
--- debian/po/de.po	(.../tags/2.8.4sarge1)	(revision 0)
+++ debian/po/de.po	(.../people/michael/features/debconf)	(revision 5044)
@@ -0,0 +1,126 @@
+#
+#    Translators, if you are not familiar with the PO format, gettext
+#    documentation is worth reading, especially sections dedicated to
+#    this format, e.g. by running:
+#         info -n '(gettext)PO Files'
+#         info -n '(gettext)Header Entry'
+#
+#    Some information specific to po-debconf are available at
+#            /usr/share/doc/po-debconf/README-trans
+#         or http://www.debian.org/intl/l10n/po-debconf/README-trans
+#
+#    Developers do not need to manually edit POT or PO files.
+#
+#, fuzzy
+msgid ""
+msgstr ""
+"Project-Id-Version: PACKAGE VERSION\n"
+"Report-Msgid-Bugs-To: \n"
+"POT-Creation-Date: 2005-04-08 16:29+0200\n"
+"PO-Revision-Date: 2005-04-02 10:36+0200\n"
+"Last-Translator: Michael Tautschnig <tautschn@model.in.tum.de>\n"
+"Language-Team: LANGUAGE <LL@li.org>\n"
+"MIME-Version: 1.0\n"
+"Content-Type: text/plain; charset=ISO-8859-15\n"
+"Content-Transfer-Encoding: 8bit\n"
+
+#. Type: string
+#. Description
+#: ../templates:3
+msgid "Set install server hostname."
+msgstr "Setzen des hostnames des install servers."
+
+#. Type: string
+#. Description
+#: ../templates:3
+#, fuzzy
+msgid "FAI needs a name for the install server to be used."
+msgstr "FAI benötigt einen Namen des install servers."
+
+#. Type: string
+#. Description
+#: ../templates:3
+msgid ""
+"In most cases this will be the hostname of the machine where the FAI package "
+"is installed, so we use this as a default value."
+msgstr ""
+"Im Allgemeinen wird das der hostname der Machine sein, wo das FAI Paket "
+"installiert wird, also ist das der Standardwert"
+
+#. Type: string
+#. Description
+#: ../templates:3
+msgid ""
+"In case you want your install clients to use another install server, please "
+"provide it's hostname."
+msgstr ""
+"Falls Sie einen anderen install server benützen möchten, geben Sie bitte  "
+"dessen hostname an."
+
+#. Type: string
+#. Description
+#: ../templates:14
+#, fuzzy
+msgid "Set the hostname of the debian mirror to be used."
+msgstr "FAI benötigt einen Namen des install servers."
+
+#. Type: string
+#. Description
+#: ../templates:14
+#, fuzzy
+msgid ""
+"FAI needs the hostname of the debian mirror used for creating the nfsroot "
+"and to get packages for the actual installation."
+msgstr ""
+"FAI benötigt den hostname eines Debian-Paketspiegles für die Erzeugung des "
+"nfsroot und für die eigentliche Installation."
+
+#. Type: string
+#. Description
+#: ../templates:14
+msgid ""
+"In case you are running your own debian mirror, and want to use this  for "
+"FAI, please enter it's hostname here. In case you don't have an own debian "
+"mirror, you will most probably use ftp.debian.org for that, which we provide "
+"as a default."
+msgstr ""
+"Wenn Sie einen eigenen Debian-Paketspiegel betreiben, und diesen für FAI "
+"benützen möchten, geben Sie den hostname bitte hier ein. Ansonsten können "
+"Sie beispielsweise ftp.debian.org benützen."
+
+#. Type: boolean
+#. Description
+#: ../templates:26
+msgid "Run fai-setup script now?"
+msgstr "Soll fai-setup jetzt ausgeführt werden?"
+
+#. Type: boolean
+#. Description
+#: ../templates:26
+#, fuzzy
+msgid ""
+"To be able to do installations with FAI, the script fai-setup needs to be "
+"run. In case you don't need to tweak the default FAI config any further, "
+"this can be done for you now."
+msgstr ""
+"Um tatsächlich Installationen mit FAI durchzuführen, muss fai-setup "
+"ausgeführt werden. Wenn Sie die Standardeinstellungen nicht verändern "
+"möchten, kann das jetzt automatisch gestartet werden."
+
+#. Type: boolean
+#. Description
+#: ../templates:26
+#, fuzzy
+msgid ""
+"If you intend to have a look at and tweak the config files, it's perfectly "
+"okay to run the script fai-setup manually after you consider the "
+"configuration fitting for you."
+msgstr ""
+"Wenn Sie noch einen Blick auf die Konfigurationsdateien werfen möchten, "
+"können Sie fai-setup auch später manuell ausführen."
+
+#. Type: boolean
+#. Description
+#: ../templates:26
+msgid "Do you want the fai-setup script to be run now?"
+msgstr "Soll fai-setup jetzt ausgeführt werden?"
Index: debian/po/POTFILES.in
===================================================================
--- debian/po/POTFILES.in	(.../tags/2.8.4sarge1)	(revision 0)
+++ debian/po/POTFILES.in	(.../people/michael/features/debconf)	(revision 5044)
@@ -0,0 +1 @@
+[type: gettext/rfc822deb] templates
Index: conf/fai.conf
===================================================================
--- conf/fai.conf	(.../tags/2.8.4sarge1)	(revision 5044)
+++ conf/fai.conf	(.../people/michael/features/debconf)	(revision 5044)
@@ -2,10 +2,7 @@
 
 # /etc/fai/fai.conf -- configuration for FAI (Fully Automatic Installation)
 
-# installserver must be the name seen by the install clients
-installserver=INSTALLSERVER
-# the name of the Debian mirror, this is also hardcoded in /etc/fai/sources.list
-mirrorhost=ftp.debian.org
+[ -r /etc/default/fai ] && . /etc/default/fai
 
 # Don't use the variable FAI_SOURCES_LIST any more.
 # Instead use /etc/fai/sources.list 
Index: scripts/make-fai-nfsroot
===================================================================
--- scripts/make-fai-nfsroot	(.../tags/2.8.4sarge1)	(revision 5044)
+++ scripts/make-fai-nfsroot	(.../people/michael/features/debconf)	(revision 5044)
@@ -206,6 +206,7 @@
     fdivert /etc/dhcp3/dhclient-script /etc/dhcp3/dhclient.conf
     cp -p $SHAREFAI/etc/dhclient.conf etc/dhcp3
     cp -Rpv $cfdir/* $NFSROOT/etc/fai
+    cp -p /etc/default/fai $NFSROOT/etc/default/
     # remove some files that should not be copied
     rm -f $NFSROOT/etc/fai/make-fai-nfsroot.conf
     [ -f $cfdir/.cvspass ] && cp -p $v $cfdir/.cvspass $NFSROOT/.cvspass
@@ -276,6 +277,8 @@
 	  echo "I think something is wrong. But I'll try to continue."
         }
 
+    perl -pi -e "s/MIRRORHOST/$mirrorhost/" $NFSROOT/etc/apt/sources.list
+
     echo "127.0.0.1 localhost" >> etc/hosts
     echo "$NFSROOT_ETC_HOSTS" >> etc/hosts
     [ -f /etc/apt/preferences ] && cp -v /etc/apt/preferences $NFSROOT/etc/apt
Index: Makefile
===================================================================
--- Makefile	(.../tags/2.8.4sarge1)	(revision 5044)
+++ Makefile	(.../people/michael/features/debconf)	(revision 5044)
@@ -43,6 +43,7 @@
 	install -m644 conf/menu.lst conf/sources.list $(DESTDIR)/etc/fai/
 	install -m644 conf/fai.conf conf/sources.list $(DESTDIR)/etc/fai/
 	install -m600 conf/make-fai-nfsroot.conf $(DESTDIR)/etc/fai/
+	install -m644 debian/default.tpl $(DESTDIR)/etc/default/fai
 	cp -a examples $(DOCDIR)
 	cp -a utils $(DOCDIR)/examples
 	cp -a templates/* $(DOCDIR)/examples/advanced
