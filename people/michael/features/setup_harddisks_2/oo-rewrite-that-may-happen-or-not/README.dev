################################################################################
# TODO list
# - parted, libparse-recdescent-perl must get installed in nfsroot (add Depends:
#   to fai-nfsroot package)
#
# - closes #380629, #330915, #277045, #356862, #416633
# - no-bug: #364763
#
# - auto mode (something like auto:server, auto:desktop?)
# - man page
#
# - resize should imply resizing the filesystem as well (unless this is done by
#   parted already, needs to be checked)
# - LVMs definitely require resizing the filesystem
# - more error messages must be caught by shdd2-exec
# - how to detect old-style config files? migration strategies?
# - implement disklabels other than msdos and gpt
# - the RAID commands are surely incomplete and lack any management of
#   unanticipated situations
# - try to get libparted-swig-perl and use that one instead of the manual
#   parsing
################################################################################

################################################################################
#
# @brief The hash of all configurations specified in the disk_config file
#
# The structure is as follows:
# PHY_<DEVICE>
#   virtual (0|1)
#   disklabel STRING
#   bootable -1..n
#   partitions
#     <1..n>
#       size
#         extended (0|1)
#         preserve (0|1)
#         resize (0|1)
#         range
#         eff_size
#       number 1..n
#       maps_to_existing 1..n
#       start_byte
#       end_byte
#       mountpoint
#       mount_options
#       filesystem
#       fs_options
#       label
# VG_<NAME>
#   devices
#   estimated_size
#   volumes
#     <logical-volume-name>
#       size
#         preserve (0|1)
#         resize (0|1)
#         range
#         eff_size
#       mountpoint
#       mount_options
#       filesystem
#       fs_options
#       label
# RAID
#   volumes
#     <0..n>
#       mode
#       devices
#         /dev/<device-name>
#           options
#             spare (0|1)
#             missing (0|1)
#       mountpoint
#       mount_options
#       filesystem
#       fs_options
#       label
#
################################################################################

################################################################################
#
# @brief The current disk configuration
#
# The structure is as follows:
# <DEVICE>
#   bios_cylinders
#   bios_heads
#   bios_sectors_per_track
#   sector_size
#   disklabel
#   begin_byte
#   end_byte
#   partitions
#     <1..n>
#       begin_byte
#       end_byte
#       count_byte
#       is_extended
#       filesystem
#
################################################################################

################################################################################
#
# @brief The current LVM configuration
#
# The structure is as follows:
# <VG>
#   physical_volumes
#   size
#   volumes
#     <lv-name>
#       size
#
################################################################################

################################################################################
#
# @brief The current RAID configuration
#
# The structure is as follows:
# <0..n>
#   devices
#   mode
#
################################################################################

################################################################################
#
# @file shdd2-parser
#
# @brief A parser for the disk_config files within FAI, based on the EBNF
# listed below. The implementation makes use of the RecDescent package.
#
# file ::= <lines> EOF
#
# lines ::= EOL
#           /* empty lines or whitespace only */
#           | <comment> EOL
#           | <config> EOL
#
# comment ::= #.*
#
# config ::= disk_config lvm
#            | disk_config raid
#            | disk_config end
#            | disk_config disk[[:digit:]]+( <option>)*
#            | disk_config [^[:space:]]+( <option>)*
#            /* fully qualified device-path or short form, like hda, whereby full
#             * path is assumed to be /dev/hda */
#            | <volume>
#
# option ::= /* empty */
#            | preserve:[[:digit:]]+(,[[:digit:]]+)*
#            /* preserve partitions */
#            | resize:[[:digit:]]+(,[[:digit:]]+)*
#            /* attempt to resize partitions */
#            | disklabel:(msdos|gpt)
#            /* write a disklabel - default is msdos */
#            | bootable:[[:digit:]]+
#            /* mark a partition bootable, default is / */
#            | virtual
#            /* do not assume the disk to be a physical device, use with xen */
#            | fstabkey:(device|label|uuid)
#            /* when creating the fstab, the key used for defining the device
#            may be the device (/dev/xxx), a label given using -L, or the uuid
#            */
#
# volume ::= <type> <mountpoint> <size> <filesystem> <mount_options> <fs_options>
#            | vg <name> <size>
#            /* lvm vg */
#
# type ::= primary
#          /* for physical disks only */
#          | logical
#          /* for physical disks only */
#          | raid[0156]
#          /* raid level */
#          | [^/[:space:]]+-[^/[:space:]]+
#          /* lvm logical volume: vg name and lv name*/
#
# mountpoint ::= -
#                /* do not mount */
#                | swap
#                /* swap space */
#                | /[^[:space:]]*
#                /* fully qualified path */
#
# name ::= [^/[:space:]]+
#          /* lvm volume group name */
#
# size ::= [[:digit:]]+[kMGTP%]?(-([[:digit:]]+[kMGTP%]?)?)?(:resize)?
#          /* size in kilo, mega (default), giga, tera or petabytes or %,
#           * possibly given as a range; physical
#           * partitions or lvm logical volumes only; */
#          | -[[:digit:]]+[kMGTP%]?(:resize)?
#          /* size in kilo, mega (default), giga, tera or petabytes or %,
#           * given as upper limit; physical partitions
#           * or lvm logical volumes only */
#          | [^,:[:space:]]+(:(spare|missing))*(,[^,:[:space:]]+(:(spare|missing))*)*
#          /* devices and options for a raid or lvm vg */
#
# mount_options ::= [^[:space:]]+
#
# filesystem ::= -
#                | swap
#                | [^[:space:]]
#                /* mkfs.xxx must exist */
#
# fs_options ::= .*
#                /* options appended to mkfs.xxx call */
#
#
# $Id: shdd2-parser 4631 2007-10-18 15:23:23Z andreas $
#
# @author Christian Kern, Michael Tautschnig, Sam Vilain, Andreas Schuldei
# @date Sun Jul 23 16:09:36 CEST 2006
#
################################################################################

