#!/usr/bin/perl

use Parse::RecDescent;

my $Parser = Parse::RecDescent->new(q{
    file: line(s?) /\Z/
    line: /$/
        | comment /$/
        | config /$/
    comment: /\s*#.*$/
    config:
          'disk_config' disk_config_arg
        | volume
    disk_config_arg:
          'raid'
        | 'lvm'
        | /disk\d+/ option(s?)
        | /\S/ option(s?)
    option:
          /preserve:\d+(,\d+)*/
        | /disklabel:(msdos|sun)/
        | /bootable:\d/
        | 'virtual'
    volume:
          type mountpoint size filesystem mount_options fs_options
        | 'vg' name size
    type: 'primary'
        | 'logical'
        | /raid[0156]/
        | m{[^/\s]+-[^/\s]+}
    mountpoint:
          '-'
        | 'swap'
        | m{/\S*}
    name: /\S+/
    size: /\d+%?(-\d+%?)?(:resize)?/
        | /-\d+%?(:resize)?/
        | /preserve\d+/
        | /[^,:\s]+(:(spare|missing))*(,[^,:\s]+(:(spare|missing))*)*/
    mount_options:
          /\S+/
    filesystem:
          '-'
        | 'swap'
        | \S+
          { if ( !in_path("mkfs.$item[0]") ) {
                die "unknown/invalid filesystem type '$item[0]'"
            }
          }
    fs_options:
          /.*$/
});

